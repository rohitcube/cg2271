/*******************************
 * Simple Program: Blink Green LED
 * Board: FRDM-MCXC444 (NXP MCXC444VLH MCU)
 * - Green LED: PTD5 (active-low)
 *
 * Behavior:
 * - Blinks green LED at ~1 Hz (500ms on, 500ms off).
 * - No switch â€“ blinks continuously.
 *******************************/

#include <stdio.h>
#include "board.h"
#include "peripherals.h"
#include "pin_mux.h"
#include "clock_config.h"
#include "fsl_debug_console.h"

#define GREENLED 5  // PTD5

// From your original code: initLEDs (adapted for green only)
void initLEDs() {
    SIM->SCGC5 |= SIM_SCGC5_PORTD_MASK; // enables the clock
    PORTD->PCR[GREENLED] &= ~PORT_PCR_MUX_MASK; // clears PCR bits
    PORTD->PCR[GREENLED] |= PORT_PCR_MUX(1); // sets MUX to 1 -> configures as a GPIO pin
    GPIOD->PDDR |= (1 << GREENLED); // sets the pin as output in Port Data Direction Register
}

// Toggle green LED
void ledToggle() {
    GPIOD->PTOR |= (1 << GREENLED); // Port Toggle Output Register (PTOR). Writing 1 to the bit for pin 5 flips its state.
}

// Simple busy-wait delay (adjust count for timing)
void delay(uint32_t count) {
    volatile uint32_t i = 0; // counter
    for (i = 0; i < count; ++i) { // simple loop that runs count times
        __asm("NOP"); // do nothing - just waste clock cycle
    }
}

int main(void) {
    /* Init board hardware from your setup code */
    BOARD_InitBootPins();
    BOARD_InitBootClocks();
    BOARD_InitBootPeripherals();
#ifndef BOARD_INIT_DEBUG_CONSOLE_PERIPHERAL
    BOARD_InitDebugConsole();
#endif

    PRINTF("Green LED blinking now\r\n");

    // Init LED
    initLEDs();

    while (1) {
        ledToggle();  // Toggle state
        delay(200000);  // ~500ms delay (adjust based on your clock speed)
    }

    return 0;
}

/*******************************
 * Simple Program: Control Green LED with Global Variable
 * Board: FRDM-MCXC444 (NXP MCXC444VLH MCU)
 * - Green LED: PTD5 (active-low)
 *
 * Behavior:
 * - Uses a global boolean variable 'g_led_state' (false=0/off, true=1/on).
 * - Checks the variable in a loop and sets LED state accordingly.
 * - Currently sets g_led_state to true (ON) â€“ update as needed for your use case.
 *******************************/

#include <stdio.h>
#include <stdbool.h>  // For bool type
#include "board.h"
#include "peripherals.h"
#include "pin_mux.h"
#include "clock_config.h"
#include "fsl_debug_console.h"

#define GREENLED 5  // PTD5

// Global variable: false (0) = off, true (1) = on
bool g_led_state = false;  // Initially off; change to true for testing

// From your original code: initLEDs (adapted for green only)
void initLEDs() {
    SIM->SCGC5 |= SIM_SCGC5_PORTD_MASK;
    PORTD->PCR[GREENLED] &= ~PORT_PCR_MUX_MASK;
    PORTD->PCR[GREENLED] |= PORT_PCR_MUX(1);
    GPIOD->PDDR |= (1 << GREENLED);
}

// Turn green LED on
void ledOn() {
    GPIOD->PCOR |= (1 << GREENLED);  // Active-low: clear to ON
}

// Turn green LED off
void ledOff() {
    GPIOD->PSOR |= (1 << GREENLED);  // Active-low: set to OFF
}

// Simple busy-wait delay (for potential future use)
void delay(uint32_t count) {
    volatile uint32_t i = 0;
    for (i = 0; i < count; ++i) {
        __asm("NOP");
    }
}

int main(void) {
    /* Init board hardware from your setup code */
    BOARD_InitBootPins();
    BOARD_InitBootClocks();
    BOARD_InitBootPeripherals();
#ifndef BOARD_INIT_DEBUG_CONSOLE_PERIPHERAL
    BOARD_InitDebugConsole();
#endif

    PRINTF("Green LED controlled by global variable g_led_state\r\n");

    // Init LED
    initLEDs();

    // Example: Set global to true (ON) for testing
    g_led_state = false;

    while (1) {
        if (g_led_state) {
        	ledOn();
        	            delay(800000);  // ~500ms ON
        	            ledOff();
        	            delay(800000);  // ~500ms OFF
        } else {
            ledOff();  // LED OFF if false (0)
        }

        // Small delay to avoid 100% CPU usage; optional
        delay(400000);
    }

    return 0;
}